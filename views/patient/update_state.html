<script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>

<link rel="stylesheet" href="/assets/css/yes_no_ctrls.css" type="text/css">
<script type="text/javascript" src="/assets/js/post_parameters.js"></script>
<script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>
<script type="text/javascript" src="/assets/js/httpUtils.js"></script>
<script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
<script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>
<link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">

<style>
  #Unknown {
  display: inline !important;
}

.tt_controls_outcome_month #keyboard {
  display: none !important;
}

#tt_page_outcome_month #viewport {
  height: 95%;
}

#tt_page_outcome_month .inputFrameClass {
  height: 88%;
  width: 96%;
}

</style>

<script>
  var tstCurrentDate = moment(tstCurrentDate).format("YYYY-MM-DD");
  tt_cancel_destination = "/views/patient/programs.html?patient_id=" + sessionStorage.patientID;


function setAbsoluteMaxOutcomeYear(){
  var element = document.getElementById('touchscreenInput' + tstCurrentPage);
  element.setAttribute("absoluteMax", (new Date().getFullYear()));
  element.setAttribute("min", (new Date().getFullYear() - 100)); 
  element.setAttribute("absoluteMin", (new Date().getFullYear() - 120)); 
}

function setUpPageForDateValidation() {
  var nextBtn =  __$("nextButton");
  nextBtn.setAttribute('onmousedown',"validateOutcomeDate();");
  nextBtn.setAttribute('onclick',"");

  if(transferring_out == false)
    nextBtn.innerHTML = '<span>Finish</span>';

}

var set_dob;

function validateOutcomeDate() {
  setOutcomeDate();
  var valid_date = validateEnteredDate(set_dob);

  if(!valid_date){
    showMessage("Invalid Date");
    return;
  }

  currDate  = new Date();
  currDate  = new Date(currDate.getFullYear() + "-" + (currDate.getMonth() + 1) + "-" + (currDate.getDate() + 1));
  setDate   = new Date(set_dob);
  
  if(setDate > currDate){
    alert(currDate);
    alert(setDate);
    alert(setDate > currDate);
    showMessage("Outcome date can not be greater than the current date");
    return;
  }
 
  if(transferring_out == true){ 
    gotoNextPage();
  }else{
    submitOutcome();
  }
}

function setOutcomeDate() {
  try {
    dob_year = document.getElementById('outcome_year').value; //getElementsByTagName("input")[0].value
  }catch(e){ dob_year = dob_year }
  try {
    dob_month = document.getElementById('outcome_month').value; //getElementsByTagName("input")[0].getAttribute('tstvalue')
    if (dob_month.length == 1)
      dob_month = 0 + dob_month
  }catch(e){ dob_month = dob_month }
  try {
    dob_day = document.getElementById('outcome_day').value; //getElementsByTagName("input")[0].value
    if(dob_day.length < 1)
      dob_day = document.getElementById('touchscreenInput' + tstCurrentPage).value; //getElementsByTagName("input")[0].value

    if (dob_day.length == 1)
      dob_day = 0 + dob_day
  }catch(e){ dob_day = dob_day }

  set_dob = (dob_year + '-' + dob_month + '-' + dob_day)
}
  
function validateMonth() {
  var nextBtn =  __$("nextButton");
  nextBtn.setAttribute('onmousedown',"validateOutcomeYearMonth();");
  nextBtn.setAttribute('onclick',"");
}

function validateOutcomeYearMonth() {
  setYear = parseInt(document.getElementById('outcome_year').value);
  if(setYear == (new Date().getFullYear())){
    var element = document.getElementById('touchscreenInput' + tstCurrentPage);
    var selectedMonth = parseInt(element.getAttribute('tstValue'));
    var currMonth     = parseInt(new Date().getMonth() + 1);
    if(selectedMonth > currMonth){
      showMessage("Selected month is greater than current month");
      return;
    }
  }

  gotoNextPage();
}

function validateEnteredDate(inputText){
  // Match the date format through regular expression
  if(inputText.match(/-/i)) {

    //Test which seperator is used '/' or '-'
    var pdate = inputText.split('-');

    var dd = parseInt(pdate[2]);
    var mm  = parseInt(pdate[1]);
    var yy = parseInt(pdate[0]);

    if(dd == 0){
      return false;
    }

    // Create list of days of a month [assume there is no leap year by default]
    var ListofDays = [31,28,31,30,31,30,31,31,30,31,30,31];
    if (mm==1 || mm>2){
      if (dd>ListofDays[mm-1]) {
        //alert('Invalid date format!');
        return false;
      }
    }
  
    if (mm==2) {
      var lyear = false;
      if ( (!(yy % 4) && yy % 100) || !(yy % 400)){
        lyear = true;
      }
  
      if ((lyear==false) && (dd>=29)) {
        //alert('Invalid date format!');
        return false;
      }
  
      if ((lyear==true) && (dd>29)){
        //alert('Invalid date format!');
        return false;
      }
    }
  }else{
    //alert("Invalid date format!");
    //document.form1.text1.focus();
    return false;
  }

  return true;
}

var transferring_out = false;

function transferringOut() {
  var i = document.getElementById('states');
  transferring_out = false;

  if(parseInt(i.value) == 1744) {
    transferring_out = true;
  }
}

function validateLocation() {
  var nextBtn = document.getElementById('nextButton');
  nextBtn.setAttribute('onmousedown','submitOutcome();');
}

function submitOutcome() { 

  if(transferring_out == true) {
   var location_id = document.getElementById('to_location').value;
    if(location_id.length < 1) {
      showMessage('Please enter TO location');
      return;
    } 
  }

  var outcome_date = getOutcomeDate();

  if(transferring_out == true) {
    state = {
      location_id: document.getElementById('to_location').value,
      state: document.getElementById('states').value,
      date: outcome_date
    }
  }else{
    state = {
      state: document.getElementById('states').value,
      date: outcome_date
    }
  }

  postState(state);
}

function getOutcomeDate() {
  if(estimated_outcome_date != null || estimated_outcome_date != undefined){
    return moment(estimated_outcome_date).format('YYYY-MM-DD');
  }else{
    return moment(set_dob).format('YYYY-MM-DD');
  }
}

function setProgramStates() {
  var programID = fetchStatesUrl();
  // var elem = document.getElementById("touchscreenInput" + tstCurrentPage);
  $('touchscreenInput' + tstCurrentPage).setAttribute('ajaxURL', programID);
  listSuggestions(tstCurrentPage); 
}

function postState(state) {
  var programId = fetchArgumentFromUrlString('program_id')
  var patientId = sessionStorage.getItem('patientID')
  var apiPath = apiProtocol + '://' + apiURL + ':' + apiPort + '/api/v1/programs/' + programId + '/patients/' + patientId + '/states';

  POST (
    {
      url: apiPath,
      async: true,
      headers: {
        'Authorization': sessionStorage.getItem('authorization'),
        'Content-Type': 'application/x-www-form-urlencoded'
      }
    },
    state,
    function (data) {
      showMessage('The patient\'s state was updated successfully.')
      setTimeout(function() {
       document.location = '/views/patient/programs.html'
      }, 3000)
    },
    function (error) {
      console.error(error)
      showMessage('Outcome date cannot be less than date enrolled')
      setTimeout(function() {
        // document.location = '/views/patient/programs.html'
        // document.location = '/views/patient/programs.html?patient_id=' + sessionStorage.patientID;
      }, 3000)
    }
  )
}

var estimated_outcome_date;

function calculatePeriod() {
  var nextBtn = document.getElementById('nextButton');
  nextBtn.setAttribute('onmousedown','estimateOutcomeDate();');
  estimated_outcome_date = null;

  if(transferring_out == false)
    nextBtn.innerHTML = '<span>Finish</span>';

}

// function estimateOutcomeDate() {
//   var outcome_period_estimated = $('outcome_period_estimated').value;
//   if(outcome_period_estimated.length < 1){
//     showMessage('Please estimate the outcome date');
//     return;
//   }  

//   var curr_date = sessionStorage.sessionDate;
//   curr_date = new Date(curr_date);
//   curr_date.setDate(curr_date.getDate() - outcome_period_estimated);
//   estimated_outcome_date = curr_date;

//   if(transferring_out == true){
//     gotoNextPage();
//   }else{
//       submitOutcome();
//   }
// }


  //the date estimate comes in the form of a number and characters eg "2 years ago"
  //so we split it to get the integer part and time units and use that to subtract with the session date
function estimateOutcomeDate() {
  var splitted = $('touchscreenInput3').value.split(' ')

  var integerPart = Number(splitted[0])
  var stringPart = splitted[1].toLowerCase()
  var sessionDate = sessionStorage.sessionDate

  estimated_outcome_date = moment(sessionDate, 'YYYY-MM-DD').subtract(integerPart, stringPart).format('YYYY-MM-DD')

  if (transferring_out === true) {
    gotoNextPage()
  } else {
    submitOutcome()
  }
}

function fetchStatesUrl () {
  return '/programs/' + fetchArgumentFromUrlString('program_id') + '/workflows'
}


</script>

<body id="mateme">

<script type="text/javascript">
    tt_cancel_destination = "/views/patient/programs.html?patient_id=" + sessionStorage.patientID;
</script>
  <div id="container">
    <div id="content">

      <form>
        <input type="text" name="states" id="states" 
          field_type="alpha" xhelpText="State" 
          setvalue="" tt_pageStyleClass="NoKeyboard"
          ajaxURL="" 
          tt_onLoad="setProgramStates(); changeAbscounded();" objectType="states" />  


        <!-- Admitted -->
        <select id="admission_section" name="admission_section" 
        helpText="Select Admission section" condition ="$('touchscreenInput0').value == 'Admitted'" tt_onLoad = "changeNextAdmitBTN();">
            <option></option>
            <option>Delivered in the ward</option>
            <option>Delivered before arrival</option>
            <option>Delivered in theatre</option>
            <option>Delivered in Antenatal ward</option>
        </select>
        <!-- End admitted -->
        <!-- Discharged  -->
        <select id="discharged_to_where" name="discharged_to_where" helpText="Discharged to Where?"
          condition = "$('touchscreenInput0').value == 'Discharged'">
            <option></option>
            <option>Home- Waiting</option>
            <option>Another Health Facility</option>
        </select> 
        <input type="text" name="health_facility" objectType="location"
        id="health_facility" field_type="alpha"
        key="health_facility" helpText="Which Health Facility"
        ajaxURL="/locations?name="
        key="health_facility" allowFreeText="true"
        condition = "$('states').value == 112 && $('discharged_to_where').value == 'Another Health Facility'" />

        <input type="text" name="diagnosis" 
        id="diagnosis" field_type="text" 
        helpText="Select discharge diagnosis" 
        tt_pageStyleClass="n qwertyKeyboardOnly" 
        condition ="$('states').value == 112 " /> 

        <!-- End discharged -->

        <!-- Procedures -->
        <select id="procedure_done" name="procedure_done"
        helpText="1<sup>st</sup> Procedure done"  condition ="$('states').value == '112' || $('states').value == '111'" tt_onLoad="changeNextButton()"  >
            <option></option>
            <option>None</option>
            <option>Hysterectomy</option>
            <option>Myomectomy</option>
            <option>Bilateral tubal ligation</option>
            <option>Biopsy</option>
            <option>Ceclage</option>
            <option>Cystectomy</option>
            <option>Malsupilisation</option>
            <option>Excision</option>
            <option>Incision and drainage</option>
            <option>Caesarean Section</option>
            <option>Exam under anaesthesia</option>
            <option>Evacuation/Manual vacuum aspiration</option>
            <option>Dilation and curettage</option>
            <option>Explatory laparatomy +/- adnexectomy</option>
        </select>

          <!-- PATIENT DIED -->
        <input type="text" name="date_of_death" 
        id="date_of_death" field_type="date" 
        helpText="Date of Death" 
        tt_pageStyleClass="date" 
        condition = "$('states').value == '113'" /> 

        <input type="text" name="time_of_death" 
        id="time_of_death" field_type="advancedTime" 
        helpText="Time of Death" 
        condition = "$('states').value == '113'" /> 

        <select id="place_of_death" name="place_of_death" tt_onLoad=""
        helpText="Place of Death" condition = "$('states').value == '113'"> 
            <option></option>
            <option>Home</option>
            <option>Current Facility</option>
            <option>On the Way</option>
            <option>Other</option>
        </select>

        <input type="text" name="reason_of_death" 
        id="reason_of_death" field_type="text" 
        helpText="Select Reason of Death" 
        tt_pageStyleClass="date" 
        condition = "$('states').value == '113'" /> 

        <select id="condition_at_death" name="condition_at_death" 
        helpText="Condition at Death" condition = "$('states').value == '113'" tt_onLoad="changeNextAdmitBTN();"> 
            <option></option>
            <option>Antenatal</option>
            <option>Postpartum</option>
            <option>Intrapartum</option>
        </select>

     <!-- End patient died -->
    

        <!-- End martenity -->
        <select objectType="location" ajaxURL="/locations?name=" 
          allowFreeText="true" 
          condition="$('states').value == '2'" 
          field_type="alpha" 
          helpText="Please select facility name" 
          id="facility_name" 
          tt_onUnload="transferring_out = true"
          tt_onLoad="setCurrentLocation();"
          name="facility_name"></select>

        <input type="text" name="state_year" id="outcome_year" helpText="Outcome year" field_type="number" absoluteMin="1900"
          min="1900" tt_onLoad="setAbsoluteMaxOutcomeYear();transferringOut();" tt_pageStyleClass="Numeric NumbersOnly" />

        <select name="outcome_period_estimated" id="outcome_period_estimated" helpText="Outcome estimated period"
          condition="$('outcome_year').value.toLowerCase() == 'unknown'" tt_onLoad="calculatePeriod();__$(keyboard).style.display = none;">
          <option value=""></option>
          <option value="168">6 months ago</option>
          <option value="336">12 months ago</option>
          <option value="504">18 months ago</option>
          <option value="672">24 months ago</option>
          <option value="1344">2 years ago or more</option>
        </select>

        <select name="outcome_month" id="outcome_month" helpText="Outcome month" condition="$('outcome_year').value.toLowerCase() != 'unknown'"
          validationMessage="Please enter a valid date" tt_onUnLoad="" tt_onLoad="validateMonth();__$(keyboard).style.display = none;">
          <option value=""></option>
          <option value="1">Jan</option>
          <option value="2">Feb</option>
          <option value="3">Mar</option>
          <option value="4">Apr</option>
          <option value="5">May</option>
          <option value="6">Jun</option>
          <option value="7">Jul</option>
          <option value="8">Aug</option>
          <option value="9">Sep</option>
          <option value="10">Oct</option>
          <option value="11">Nov</option>
          <option value="12">Dec</option>
          <!-- option value="Unknown">Unknown</option -->
        </select>

        <input type="text" name="outcome_day" id="outcome_day" field_type="number" helpText="Outcome Day" condition="($('outcome_year').value != 'Unknown') && ($('outcome_month').value != 'Unknown')"
          tt_onLoad="getDayOfMonthPicker($('outcome_year').value, $('outcome_month').value);setUpPageForDateValidation(); "
          tt_onUnLoad="" />

      </form>

    </div>
  </div>
</body>

<script>
  var patientID = sessionStorage.getItem("patientID");
  var tstCurrentDate = moment(tstCurrentDate).format("YYYY-MM-DD");
  var  states;

  function changeNextAdmitBTN() {
      var nextButton =  document.getElementById('nextButton');
      nextButton.setAttribute("onmousedown","postAdmitOutcome();");
  }

  function changeNextButton() {
      var nextButton =  document.getElementById('nextButton');
      nextButton.setAttribute("onmousedown","postAdmitOutcome();")
  }
  function changeAbscounded(){
    var nextButton =  document.getElementById('nextButton');
    nextButton.setAttribute("onmousedown","postAbsoundOutcome();")
  }
  function postAbsoundOutcome(){
    var  state = document.getElementById('touchscreenInput0').value;
    if (state === 'Absconded') {
          var currentTime = moment().format(' HH:mm:ss');
          var encounter_datetime = moment(sessionStorage.sessionDate).format('YYYY-MM-DD');
          encounter_datetime += currentTime;

          var encounter = {
              encounter_type_name: 'UPDATE OUTCOME',
              encounter_type_id:  40,
              patient_id: sessionStorage.patientID,
              encounter_datetime: encounter_datetime
          };

          submitParameters(encounter, "/encounters", "postUpdateOutcomeObs");
  
    } else {
        gotoNextPage();
    }
  }

  function postAdmitOutcome() {
  
          var currentTime = moment().format(' HH:mm:ss');
          var encounter_datetime = moment(sessionStorage.sessionDate).format('YYYY-MM-DD');
          encounter_datetime += currentTime;

          var encounter = {
              encounter_type_name: 'UPDATE OUTCOME',
              encounter_type_id:  40,
              patient_id: sessionStorage.patientID,
              encounter_datetime: encounter_datetime
          };

          submitParameters(encounter, "/encounters", "postUpdateOutcomeObs");
  }



  function postUpdateOutcomeObs(encounter) {
      var admitSection = document.getElementById('admission_section').value;
      var dischargedWhere = document.getElementById('discharged_to_where').value;
      var healthFacility = document.getElementById('health_facility').value;
      var dischargeDiagnosis = document.getElementById('diagnosis').value;
      var procedure = document.getElementById('procedure_done').value;
      var procedureDiagnosis = document.getElementById('procedureDiagnosis');
      var dischargedWhere = document.getElementById('discharged_to_where').value;
      var dateOfDeath = document.getElementById('date_of_death').value;
      var timeOfDeath = document.getElementById('time_of_death').value;
      var placeOfDeath = document.getElementById('place_of_death').value;
      var reasonOfDeath = document.getElementById('reason_of_death').value;
      var conditionOfDeath = document.getElementById('condition_at_death').value;
      states = document.getElementById('states').value;
      var conceptAnswers = 
       [
          // Admission section
          {
              "deliveredInWard": 7428,
              "deliveredBeforeArrival": 7429,
              "deliveredInTheatre": 7428,
              "deliveredInAntenatalWard": 7429
          },
          // Discharged to where
          {
              "homeWaiting": 7445,
              "anotherHealthFacility": 1275
          },
          // procedure done
          {
              "none": 1107,
              "hysterectomy": 5276,
              "myomectomy": 7478,
              "bilateralTubal":1719,
              "biopsy": 3593,
              "ceclage": 7470,
              "cystectomy": 3742,
              "marsupilisation": 7472,
              "excision": 218,
              "incisionDrainage": 7476,
              "caesareanSection": 1171,
              "examAnaesthesia": 7441,
              "evacuationVacuum": 7139,
              "dilation": 7475,
              "laparatomy": 7470
          },

          //Place of death
          {
              "home": 8850,
              "currentFacility": 8847,
              "onTheWay": 7398,
              "other":6408

          },

          //Condition at death
          {
              "antenatal": 2232,
              "postpartum": 1180,
              "intrapartum": 1179
          }
      ];

      var admissionAnswer;
      var dischargedAnswer;
      var procedureAnswer;
      var placeOfDeathAnswer;
      var conditionOfDeathAnswer;

      switch(admitSection.toUpperCase()) {
          case 'DELIVERED IN THE WARD':
              admissionAnswer = conceptAnswers[0].deliveredInWard;
              break;
          case 'DELIVERED BEFORE ARRIVAL':
              admissionAnswer = conceptAnswers[0].deliveredBeforeArrival;
              break;
          case 'DELIVERED IN THEATRE':
              admissionAnswer = conceptAnswers[0].deliveredInTheatre;
              break;
          case 'DELIVERED IN ANTENATAL WARD':
             admissionAnswer = conceptAnswers[0].deliveredInAntenatalWard;
          break;
      }

      switch(dischargedWhere.toUpperCase()) {
          case 'HOME- WAITING':
              dischargedAnswer = conceptAnswers[1].homeWaiting;
              break;
          case 'ANOTHER HEALTH FACILITY':
              dischargedAnswer = conceptAnswers[1].anotherHealthFacility;
              break;
          default:
              break;
      }

       switch (procedure.toUpperCase()) {
          case 'NONE':
              procedureAnswer = conceptAnswers[2].none;
              break;
              case 'HYSTERECTOMY':
              procedureAnswer = conceptAnswers[2].hysterectomy;
              break;
              case 'MYOMECTOMY':
              procedureAnswer = conceptAnswers[2].myomectomy;
              break;
              case 'BILATERAL TUBAL LIGATION':
              procedureAnswer = conceptAnswers[2].bilateralTubal;
              break;
              case 'BIOPSY':
              procedureAnswer = conceptAnswers[2].biopsy;
              break;
              case 'CECLAGE':
              procedureAnswer = conceptAnswers[2].ceclage;
              break;
              case 'CYSTECTOMY':
              procedureAnswer = conceptAnswers[2].cystectomy;
              break;
              case 'MARSUPILISATION':
              procedureAnswer = conceptAnswers[2].marsupilisation;
              break;
              case 'EXCISION':
              procedureAnswer = conceptAnswers[2].excision;
              break;
              case 'INCISION AND DRAINAGE':
              procedureAnswer = conceptAnswers[2].incisionDrainage;
              break;
              case 'CAESAREAN SECTION':
              procedureAnswer = conceptAnswers[2].caesareanSection;
              break;
              case 'EXAM UNDER ANAESTHESIA':
              procedureAnswer = conceptAnswers[2].examAnaesthesia;
              break;
              case 'EAVACUATION/MANUAL VACUUM ASPIRATION':
              procedureAnswer = conceptAnswers[2].evacuationVacuum;
              break;
              case 'DILATION AND CURETTAGE':
              procedureAnswer = conceptAnswers[2].dilation;
              break;
              case 'EXPLATORY LAPARATOMY +/- ADNEXECTOMY':
              procedureAnswer = conceptAnswers[2].laparatomy;
              break;
          default:
              break;
      }
      switch(placeOfDeath.toUpperCase()) {
          case 'HOME':
              placeOfDeathAnswer = conceptAnswers[3].home;
              break;
          case 'CURRENT FACILITY':
              placeOfDeathAnswer = conceptAnswers[3].currentFacility;
              break;
          case 'ON THE WAY':
              placeOfDeathAnswer = conceptAnswers[3].onTheWay;
              break;
          case 'OTHER':
              placeOfDeathAnswer = conceptAnswers[3].other;
          break;
          default:
              break;
      }
      switch(conditionOfDeath.toUpperCase()) {
          case 'ANTENATAL':
              conditionOfDeathAnswer = conceptAnswers[4].antenatal;
              break;
          case 'POSTPARTUM':
              conditionOfDeathAnswer = conceptAnswers[4].postpartum;
              break;
          case 'INTRAPARTUM':
              conditionOfDeathAnswer = conceptAnswers[4].intrapartum;
              break;
          default:
              break;
      }

      if(states == 113){
        stateAnswer = "Patient died";
      }else if(states == 109){
        stateAnswer = "Admitted";
      }else if(states == 110){
        stateAnswer = "Absconded";
      }else if(states == 111){
          stateAnswer = "Delivered";
      }else if(states == 112){
          stateAnswer = "Discharged";
      }

      var obs = {
          encounter_id: encounter["encounter_id"],
          observations: [
              { concept_id: 6310, value_text: stateAnswer } 
          ]
      };

        if(admitSection !== '') {
            obs.observations.push(  { concept_id: 7427, value_coded: admissionAnswer } ); //saving
        }
        if(dischargedWhere !== '') {
            obs.observations.push(  { concept_id: 3626, value_coded: dischargedAnswer } ); //saving
        }
        if(healthFacility !== '') {
            obs.observations.push(  { concept_id: 5937, value_text: healthFacility } ); 
        }
        if(dischargeDiagnosis !== '') {
            obs.observations.push(  { concept_id: 7366, value_text: dischargeDiagnosis  } ); 
        }
        if(procedure !== '') {
            obs.observations.push(  { concept_id: 7439, value_text: procedure } ); 
        }
        if(procedureDiagnosis !== '') {
            obs.observations.push(  { concept_id: 3065, value_coded: procedureAnswer } ); 
        }
        if(dateOfDeath !== '') {
           var dayOfDeath = dateOfDeath.split('-')[0];
           var monthOfDeath = dateOfDeath.split('-')[1];
           var yearOfDeath = dateOfDeath.split('-')[2];

           var deathValue = yearOfDeath + '-' + monthOfDeath + '-' + dayOfDeath;
            obs.observations.push(  { concept_id: 1815, value_datetime: deathValue } ); 
        }
        if(timeOfDeath !== '') {
            obs.observations.push(  { concept_id: 9161, value_text: timeOfDeath } ); 
        }
        if(placeOfDeath !== '') {
            obs.observations.push(  { concept_id: 8429, value_coded: placeOfDeathAnswer } ); 
        }
        if(reasonOfDeath !== '') {
            obs.observations.push(  { concept_id: 5002, value_text: reasonOfDeath } ); 
        }
        if(conditionOfDeath !== '') {
            obs.observations.push(  { concept_id: 9162, value_coded: conditionOfDeathAnswer } ); 
        }
       submitParameters(obs, "/observations", "submitState")
 
  }

  function submitState(){
    var outcome_date = new Date().toISOString().slice(0,10);
       state = {
        state: document.getElementById('states').value,
        date: outcome_date
      }
      if(states == 111 || states == 112){
        postState(state);
        window.location.href = "../../apps/MATERNITY/views/encounters/baby_outcome.html?patient_id=" + patientID;
       }else{
        postState(state);
       }
      }

  function nextPage(){
      if(states == 111 || states == 112){
        postState(state);
        window.location.href = "../../apps/MATERNITY/views/encounters/baby_outcome.html?patient_id=" + patientID;
       }else{
        //window.location.href = "/views/patient_dashboard.html?patient_id=" + patientID;
       }
  }
</script>