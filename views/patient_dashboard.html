<!DOCTYPE html>
<html lang="en">

<head>
  <title>Baobab Health Trust</title>
  <meta charset="utf-8">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
  <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="/assets/css/maindashboard/header.css">
  <link rel="stylesheet" href="/assets/css/maindashboard/footer.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <script src="/assets/js/jquery.min.js"></script>
  <script src="/assets/js/bootstrap/bootstrap.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      // console.log('call the getFunction to retrieve the saved client data');
    });
  </script>
</head>

<body>
  <script type="text/javascript">
    var patientID = "";
    var selectedEncounterID = "";

    function finish() {
      window.location = "/";
    }

    function changeIcon(gender) {
      var img = document.getElementById('icon_id');
      if (gender === "M") {
        img.setAttribute("src", "/assets/images/male.gif");
      } else {
        img.setAttribute("src", "/assets/images/female.gif");
      }
    }

    function populateData() {

    }
  </script>

  <script src="/assets/js/generic_ajaxrequest.js">
    checkIfEnconterCaptured("vitals");
 
</script>

  <style type="text/css">
    .headTab {
      border: 1px solid #004586;
    }

    .headTab {
      height: 120px;
    }

    .headTab {
      overflow: hidden;
    }

    .headTab {
      box-shadow: 5px 2px 5px 0 rgba(0, 0, 0, 0.75);
    }

    .headTab {
      width: 100%;
    }

    .active-link {
      background-color: #345db5;
      border-bottom: 1px solid #ccc;
      color: #fff;
      cursor: pointer;
      margin-bottom: 5px;
      padding: 15px 10px;
      text-align: center;
    }


    #session-date {
      padding-right: 20px;
    }

    .taskBtns {
      background-color: #538fbe;
      border-radius: 7px;
      border-bottom: 1px outset black;
      border-style: outset;
      border-top: 1px outset black;
      color: white;
      display: block;
      padding: 10px 16px 10px 10px;
      text-align: center;
      text-decoration: none;
      width: 100%;
      height: 60px;
    }

    .tasks {
      padding: 0.5%;
    }

    .container {
      margin: 0;
      padding: 0;
    }

    .shaddows {
      box-shadow: 0 15px 30px 0 rgba(0, 0, 0, 0.2);
    }

    td {
      width: 30%;
    }

    .cards {
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
    }

    #cover {
      position: absolute;
      display: none;
      background-color: black;
      width: 100%;
      height: 102%;
      left: 0%;
      top: 0%;
      z-index: 990;
      opacity: 0.5;
    }

    @keyframes fade {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }

      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .confirm {
      position: absolute;
      display: none;
      top: 35%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      min-width: 280px;
      max-width: 500px;
      height: auto;
      background: #E2E2E2;
      border-radius: 10px;
      padding: 0;
      margin: 0;
      border-top: 1px solid white;
      animation: fade 1s ease 1 forwards;
      z-index: 999;
    }

    .confirm h1 {
      text-align: center;
      font-size: 1.2rem;
      margin: 1.5rem 1rem 0.5rem;
    }

    .confirm p {
      text-align: center;
      font-size: 1rem;
      margin: 0 2rem 4.5rem;
    }

    .confirm button {
      background: transparent;
      border: none;
      color: #1678E5;
      height: 3rem;
      font-size: 1rem;
      width: 50%;
      position: absolute;
      bottom: 0;
      cursor: pointer;
    }

    .confirm button:nth-of-type(1) {
      border-top: 1px solid #B4B4B4;
      border-right: 1px solid #B4B4B4;
      left: 0;
      border-radius: 0 0 0 10px;
    }

    .confirm button:nth-of-type(2) {
      border-top: 1px solid #B4B4B4;
      right: 0;
      border-radius: 0 0 10px 0;
    }

    .confirm button:focus,
    .confirm button:hover {
      font-weight: bold;
      background: #EFEFEF;
    }

    .confirm button:active {
      background: #D6D6D6;
    }
  </style>
  <!-- <div class="table-div-cell app-details " style="float:left;" id="details">

</div> -->

  <div class="container" style="width: 100%; margin-bottom: 1%;">

    <div class="col-sm-8 col-lg-8 col-md-8 col-xs-8  cards" style="border: solid 1px; border-radius: 3%; height: 120px; padding: 0; width: 75%; margin-left: 1%;">
      <table class="table-sm table-bordered" style="height: 100%;">
        <tr>
          <td class="h4" align="right"> <img id="icon_id" alt="person_icon"></td>
          <td class="h4 text-muted" id="patient_name">Name</td>
          <th class="h4">Home Address</th>
          <td id="addressl3" class="h4 text-muted">&nbsp;</td>

        </tr>
        <tr>
          <th class="h4" class="text-muted">Date of Birth:</th>
          <td class="h4 text-muted" id="age">&nbsp;</td>
          <th class="h4">Current Address </th>
          <td id="addressl1" class="h4 text-muted">&nbsp;</td>

        </tr>
        <tr>
          <th class="h4">National ID</th>
          <td id="npid" class="h4 text-muted">&nbsp;</td>

          <th class="h4">Phone Number</th>
          <td id="phone_number" class="h4 text-muted">&nbsp;</td>


        </tr>
      </table>

    </div>

    <div class="col-sm-4 col-lg-4 col-md-4 col-xs-4 cards" style="border: solid 1px;border-radius: 3%; height: 120px; padding: 0;margin-left: 3%; width: 20%;">

      <img src="/assets/images/BaobabHealth.png" id="application-icon" style="height: 80%; border:solid 1px;border-radius: 50%; margin-top: 2%; margin-left: 1.5%; width: 30%; float: left; box-shadow: 0 10px 14px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);">
      <h3 style="text-align: center" id="application-name"> ART</h4>
        <h5 style="text-align: center"> v1.0.0</h5>
    </div>


    <div class="col-sm-2 col-lg-2 col-xl-2" id="dates" style="margin-top: 1%; border: solid 1px;overflow: auto; padding: 0; height: 550px;">

      <h4>Visit Dates</h4>
    </div>

    <div class="col-sm-10 col-lg-10 col-md-10 col-xs-10" style="border: solid 1px;  padding: 0; margin: 0; height: 550px; margin-top: 1%;"
      id="generic_tabs">

      <div class="row">

        <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px;  ">
          <h4>Encounters</h4>
          <div class="cards" id="encounters" style="border: solid 1px;  padding: 0; margin: 1%; max-height: 250px; overflow: auto;">
            <button type="button" id="0" class="btn btn-info btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">No Encounter History available </button>
          </div>
        </div>
        
        <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px;  ">
          <h4>Alerts</h4>
          <div class="cards" id="alerts" style="border: solid 1px;  padding: 0; margin: 1%; max-height: 250px; overflow: auto;">
            <button type="button" id="0" class="btn btn-info btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">No Alert History available</button>
          </div>
        </div>

      </div>
      <div class="row">

        <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px;  ">
          <h4>Programs</h4>
          <div class="cards" id="programs" style="border: solid 1px;  padding: 0; margin: 1%; max-height: 250px; overflow: auto;">
            <button type="button" id="0" class="btn btn-info btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">No Program History available</button>
          </div>
        </div>
        
        <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px;  ">
          <h4>Latest Medication</h4>
          <div class="cards" id="medication" style="border: solid 1px;  padding: 0; margin: 1%; max-height: 250px; overflow: auto;">
            <button type="button" id="0" class="btn btn-info btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">No Medication History available</button>
          </div>
        </div>

      </div>

   
      <!-- <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">First</th>
            <th scope="col">Last</th>
            <th scope="col">Handle</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
          </tr>
          <tr>
            <th scope="row">2</th>
            <td>Jacob</td>
            <td>Thornton</td>
            <td>@fat</td>
          </tr>
          <tr>
            <th scope="row">3</th>
            <td>Larry</td>
            <td>the Bird</td>
            <td>@twitter</td>
          </tr>
        </tbody>
      </table> -->
    </div>
    <!-- </div>
<div class="table-div-cell app-icon" style="width: 50%; ">&nbsp;

</div>

<div class="container">

  <div class="col-sm-3" style="border: solid 1px;">
    assadssa
  </div>

  <div class="col-sm-9" style="border: solid 1px;">
ssss
    </div>


</div> -->



    <!-- Modal -->
    <div class="modal fade" id="myModal" data-backdrop="static" data-keyboard="false" role="dialog">
      <div class="modal-dialog" name="div2">
        <div class="modal-content" style="margin-left:0px;">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Select module</h4>
          </div>
          <!-- <button class="previous round">
                  <</button>
                  <button class="next round">></button> -->
          <div class="modal-body">
            <div class="container">
              <div class="row" id="modal-div">
                <template id="card_template">
                  <!-- <div class="" > -->
                  <div class="app-btn" id="cardDiv" style="margin: 10px;">
                    <a href="#" class="card-block clearfix" id="moduleButton">
                      <img alt="Avatar" style="width:70px; height: 60px; margin-top: 10%;" id="cardImage">
                      <div class="middle">
                        <div class="text">
                          <p id="apptext"></p>
                        </div>
                      </div>
                      <div class="card-container">
                        <h4>
                          <b id="appName"></b>
                        </h4>
                        <p id="appDescription"></p>
                      </div>
                    </a>
                  </div>
                  <!-- </div> -->
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal -->
    <footer class="footer">
      <div class="container-footer">
        <button id="btnNext" class="green right" style="margin: 5px 0px 0px; padding: 0px; float: right;" onclick="finish();">
          <span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Finish &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;</span>
        </button>
        <button class="btn btn-success buttons blue" style="margin-right: 5px;" data-toggle="modal" data-target="#myModal">
          <span>&nbsp;&nbsp; Applications &nbsp;&nbsp;<img src="/assets/images/launcher.png"></span>
        </button>
        <button id="activities" class="btn btn-success buttons blue" style="margin-right: 5px;" data-toggle="modal"
          onmousedown="showActivities(this); loadActivitiesContent(this.id);">
          <span>&nbsp; &nbsp; &nbsp; Activities &nbsp; &nbsp; &nbsp;</span>
        </button>
        <button class="btn btn-success buttons blue" style="margin-right: 5px;" data-toggle="modal" data-target="#myModal">
          <span>&nbsp; &nbsp; &nbsp; Tasks &nbsp; &nbsp; &nbsp;</span>
        </button>
      </div>
  </div>
  </footer>

  <!--   <div id="footer" style="background-color: rgb(51, 51, 51); bottom: -13px; position: relative;">
    <div class="buttons" style="margin-bottom: -200px; padding-bottom: 10px; padding-top: 10px;">
      <button onclick="cancel();" style="margin: 5px 0px 0px;" class="red left">
        <span>Cancel</span>
      </button>
      <button onclick="finish();" style="margin: 5px 0px 0px; float: right;" onclick="finish();" class="green right" id="btnNext">
        <span>Finish</span>
      </button>
        <button style="margin: 5px 0px 0px; float: right;" onclick="setDate();" class="blue right" id="btnCancel">
          <span>Set Date</span>
        </button>
        <button style="margin: 5px 0px 0px; float: right;" onclick="resetDate();" class="blue right" id="btnCancel">
          <span>Reset Date</span>
        </button>
      <button  onclick="loadActivities();" style="margin: 5px 0px 0px; float: right;" class="blue right">
        <span>Activities</span>
      </button>
    </div>
  </div> -->
  </div>

  <div id="cover">

  </div>

  <div class="confirm">
    <h1>Confirm your action</h1>
    <p>Are you really <em>really</em> <strong>really</strong> sure that you want to void the selected encounter?</p>
    <button onclick="hidePopup();">Cancel</button>
    <button autofocus onclick="confirmAction();">Confirm</button>
  </div>
</body>
<script src="/assets/js/core.js "></script>
<script>
  generateTemplate();
  var url = new URL(url);
  var apiURL = sessionStorage.getItem("apiURL");
  var apiPort = sessionStorage.getItem("apiPort");
  var apiProtocol = sessionStorage.getItem("apiProtocol");
  var id = url.searchParams.get("patient_id");
  (document.getElementsByClassName("overview-btns ")[0]);
  (document.getElementsByClassName("activities-btns ")[0]);
  changeModule();
  url = new URL(url);
  var d = new Date();

  function ajaxRequest() {
    var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/patients/' + id;
    var req = new XMLHttpRequest();
    req.onreadystatechange = function () {

      if (this.readyState == 4 && this.status == 200) {
        var results = JSON.parse(this.responseText);
        var age = results.person.birthdate;
        var gender = results.person.gender;
        var identifier = "";
        var patient_name = results.person.names[0].given_name + " " + results.person.names[0].family_name;
        var addressl1 = results.person.addresses[0].address1;
        var addressl2 = results.person.addresses[0].address2;
        var phone_number = results.person.person_attributes[1].value;
        try {
          identifier = results.patient_identifiers[0].identifier || "no value available";
        } catch (e) {

        }

        setValues(patient_name, gender, age, addressl1, addressl2, phone_number, identifier);
      }
    };
    try {
      req.open('GET', url, true);
      req.setRequestHeader('Authorization', sessionStorage.getItem("authorization"))
      req.send(null);
    } catch (e) {}
  }

  function finish() {
    window.location = "/";
  }

  function setValues(patient_name, gender, age, addressl1, addressl2, phone_number, identifier) {
    document.getElementById("patient_name").innerHTML = patient_name;
    // document.getElementById("gender").innerHTML = gender;
    document.getElementById("age").innerHTML = age;
    document.getElementById("npid").innerHTML = identifier;
    document.getElementById("addressl1").innerHTML = addressl1;
    document.getElementById("addressl3").innerHTML = addressl2;
    document.getElementById("phone_number").innerHTML = phone_number;
    changeIcon(gender);
  }

  function getDates(patient_id) {
    var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/patients/' + patient_id + '/visits';
    var div = document.getElementById("dates");
    var req = new XMLHttpRequest();
    id = patient_id;
    req.onreadystatechange = function () {

      if (this.readyState == 4 && this.status == 200) {
        var results = JSON.parse(this.responseText);
        // console.log(results);
        
        for (var x = 0; x < results.length; x++) {
          div.innerHTML += '<button type="button" id="' + x + '" value="' + results[x] +
            '" class="btn btn-primary btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="getValue(this, ' +
            patient_id + '); getPrograms('+patient_id+');">' +
            results[x] + '</button>';
            if (x == 0) {
              // console.log(results[0]);
              // getValue(this, patient_id);
               
            }

        }
      }
    };
    try {
      req.open('GET', url, true);
      req.setRequestHeader('Authorization', sessionStorage.getItem('authorization'));
      req.send(null);
    } catch (e) {}
  }

  getDates(id);
  
  function getValue(value, id) {
    console.log(value);
    
    var encounters = document.getElementById("encounters");
    if (encounters.innerHTML != null) {
      encounters.innerHTML = "";
    } else {}
    var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/encounters?patient_id=' + id + '&date=' + value.value;
    var req = new XMLHttpRequest();
    // document.createElement()
    req.onreadystatechange = function () {

      if (this.readyState == 4 && this.status == 200) {
        var results = JSON.parse(this.responseText);
        // console.log(results);
        for (var x = 0; x < results.length; x++) {
          //  console.log(results[x].type.name);
          encounters.innerHTML += '<button type="button" id="' + x +
            '" class="btn btn-success btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">' +
            results[x].type.name + '</button>';
        }
      }
    };
    try {
      req.open('GET', url, true);
      req.setRequestHeader('Authorization', sessionStorage.getItem('authorization'));
      req.send(null);
    } catch (e) {}

  }
  
function getPrograms(id) {

var programs = document.getElementById("programs");
if (programs.innerHTML != null) {
      programs.innerHTML = "";
    } else {}
var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/patients/' + id + '/programs/';
var req = new XMLHttpRequest();
// document.createElement()
req.onreadystatechange = function () {

  if (this.readyState == 4 && this.status == 200) {
    var results = JSON.parse(this.responseText);
    console.log(results);
    for (var x = 0; x < results.length; x++) {
       var name = results[x].program.concept.concept_names[0].name;
      programs.innerHTML += '<button type="button" id="' + x +
        '" class="btn btn-success btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">' +
        name.toUpperCase()+ '</button>';
    }
  }
};
try {
  req.open('GET', url, true);
  req.setRequestHeader('Authorization', sessionStorage.getItem('authorization'));
  req.send(null);
} catch (e) {}

}

  // document.getElementById('appIcon').setAttribute("src", sessionStorage.getItem('applicationImage'));
  ajaxRequest();
  function setDefaults() {
    document.getElementById("0").click();
  }

  setDefaults();
  
</script>

</html>
<script src="/assets/js/generic_ajaxrequest.js"></script>