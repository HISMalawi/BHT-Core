<!DOCTYPE html>
<html lang="en">
   <head>
      <title>Baobab Health Trust</title>
      <meta charset="utf-8">
      <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
      <link rel="stylesheet" href="/assets/css/bootstrap/bootstrap.min.css">
      <link rel="stylesheet" href="/assets/css/maindashboard/header.css">
      <link rel="stylesheet" href="/assets/css/maindashboard/footer.css">
      <link rel="stylesheet" href="/assets/css/custom.css">
      <script src="/assets/js/jquery.min.js"></script>
      <script src="/assets/js/bootstrap/bootstrap.min.js"></script>
      <script src="/assets/js/moment.js"></script>
      <script type="text/javascript">
         $(document).ready(function () {
           // console.log('call the getFunction to retrieve the saved client data');
         });
      </script>
   </head>
   <body>
      <script type="text/javascript">
         var patientID = "";
         var selectedEncounterID = "";
         
         function finish() {
           window.location = "/";
         }
         
         function changeIcon(gender) {
           var img = document.getElementById('icon_id');
           if (gender === "M") {
             img.setAttribute("src", "/assets/images/male.gif");
           } else {
             img.setAttribute("src", "/assets/images/female.gif");
           }
         }
         
         function populateData() {
         
         }
      </script>
      <script src="/assets/js/generic_ajaxrequest.js">
         checkIfEnconterCaptured("vitals");
         
      </script>
      <style type="text/css">
         .headTab {
         border: 1px solid #004586;
         }
         .headTab {
         height: 120px;
         }
         .headTab {
         overflow: hidden;
         }
         .headTab {
         box-shadow: 5px 2px 5px 0 rgba(0, 0, 0, 0.75);
         }
         .headTab {
         width: 100%;
         }
         .active-link {
         background-color: #345db5;
         border-bottom: 1px solid #ccc;
         color: #fff;
         cursor: pointer;
         margin-bottom: 5px;
         padding: 15px 10px;
         text-align: center;
         }
         #session-date {
         padding-right: 20px;
         }
         .taskBtns {
         background-color: #538fbe;
         border-radius: 7px;
         border-bottom: 1px outset black;
         border-style: outset;
         border-top: 1px outset black;
         color: white;
         display: block;
         padding: 10px 16px 10px 10px;
         text-align: center;
         text-decoration: none;
         width: 100%;
         height: 60px;
         }
         .tasks {
         padding: 0.5%;
         }
         .container {
         margin: 0;
         padding: 0;
         }
         .shaddows {
         box-shadow: 0 15px 30px 0 rgba(0, 0, 0, 0.2);
         }
         td {
         width: 30%;
         }
         .cards {
         box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(88, 81, 81, 0.445);
         /* box-shadow: 19px 19px 38px rgba(0,0,0,0.30), 0 19px 12px rgba(0,0,0,0.22); */
         }
         li {
         /* list-style: none; */
         }
         body {
           overflow: hidden;
         }
         #cover {
         position: absolute;
         display: none;
         background-color: black;
         width: 100%;
         height: 102%;
         left: 0%;
         top: 0%;
         z-index: 990;
         opacity: 0.5;
         }
         @keyframes fade {
         from {
         opacity: 0;
         transform: translate(-50%, -50%) scale(0.8);
         }
         to {
         opacity: 1;
         transform: translate(-50%, -50%) scale(1);
         }
         }
         .confirm {
         position: absolute;
         display: none;
         top: 35%;
         left: 50%;
         transform: translate(-50%, -50%);
         width: 80%;
         min-width: 280px;
         max-width: 500px;
         height: auto;
         background: #E2E2E2;
         border-radius: 10px;
         padding: 0;
         margin: 0;
         border-top: 1px solid white;
         animation: fade 1s ease 1 forwards;
         z-index: 999;
         }
         .confirm h1 {
         text-align: center;
         font-size: 1.2rem;
         margin: 1.5rem 1rem 0.5rem;
         }
         .confirm p {
         text-align: center;
         font-size: 1rem;
         margin: 0 2rem 4.5rem;
         }
         .confirm button {
         background: transparent;
         border: none;
         color: #1678E5;
         height: 3rem;
         font-size: 1rem;
         width: 50%;
         position: absolute;
         bottom: 0;
         cursor: pointer;
         }
         .confirm button:nth-of-type(1) {
         border-top: 1px solid #B4B4B4;
         border-right: 1px solid #B4B4B4;
         left: 0;
         border-radius: 0 0 0 10px;
         }
         .confirm button:nth-of-type(2) {
         border-top: 1px solid #B4B4B4;
         right: 0;
         border-radius: 0 0 10px 0;
         }
         .confirm button:focus,
         .confirm button:hover {
         font-weight: bold;
         background: #EFEFEF;
         }
         .confirm button:active {
         background: #D6D6D6;
         }
         .headers {
         margin-left: 10px;
         }
         .time {
         border: white solid 1.5px;
         background: white;
         margin: 10px;
         padding: 2px;
         /* border-radius: 30%; */
         color: black;
         font-size: 90%;
         float: right;
         /* font-size: 30px; */
         /* padding: 3px;
         /* border-radius: 0%; */
         }
         .app-btn:selected {
           color: white;
         }
      </style>
      <!-- <div class="table-div-cell app-details " style="float:left;" id="details">
         </div> -->
      <div class="container" style="width: 100%; margin-bottom: 1%;">
         <div class="col-sm-8 col-lg-8 col-md-8 col-xs-8  cards" style="margin-top: 0.7%; border: solid 1px; border-radius: 1%; height: 115px; padding: 0; width: 65%; margin-left: 1%;">
          <div class="col-md-12" style="display: flex;"><span style="width: 50%; display: flex;"><img style="height: 28px; width:28px; margin-top: 2px" id="icon_id" alt="person_icon" ></img><h4 id="patient_name"></h4> <h4 style="margin-left: 40px;" id=""></h4></span><h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>National ID:</strong></h4><h4 id="npid" style="margin-left: 40px;"></h4></div>
          <div class="col-md-12 h4" style="display: flex;" ><span style="width: 50%; display: flex;"><strong>Date of Birth:</strong> &nbsp;&nbsp;&nbsp;<span id="DOB" style="margin-left: 40px; "></span><span style="margin-left: 20px;" id="age"></span> </span><span style="margin-left: 40px;"><strong>Phone Number:</strong></span> <span id="phone_number" style="margin-left: 40px;"></span></div>
          <div class="col-md-12 h4" style="display: flex;"> <strong>Current Address</strong> <span id="addressl1" style="margin-left: 40px;"></span> <span id="addressl3" style="margin-left: 40px;"></span></div>
            <!-- <table class="table-sm table-bordered" style="height: 100%;">
               <tr>
                  <td class="h4" align="right"> </td>
                  <td class="h4 text-muted" id="patient_name">Name</td>
                  <th class="h4">Home Address</th>
                  <td id="addressl3" class="h4 text-muted">&nbsp;</td>
               </tr>
               <tr>
                  <th class="h4" class="text-muted">Date of Birth:</th>
                  <td class="h4 text-muted" id="age">&nbsp;</td>
                  <th class="h4">Current Address </th>
                  <td id="addressl1" class="h4 text-muted">&nbsp;</td>
               </tr>
               <tr>
                  <th class="h4">National ID</th>
                  <td id="npid" class="h4 text-muted">&nbsp;</td>
                  <th class="h4">Phone Number</th>
                  <td id="phone_number" class="h4 text-muted">&nbsp;</td>
               </tr>
            </table> -->
         </div>
         <div class="col-sm-4 col-lg-4 col-md-4 col-xs-4 cards" style="margin-top: 0.7%; border: solid 1px;border-radius: 1%; height: 115px; padding: 0;margin-left: 2%; width: 30%;">
            <img src="/assets/images/BaobabHealth.png" id="application-icon" style="height: 80%; border:solid 1px;border-radius: 50%; margin-top: 2%;;margin-left: 1%; width: 30%; float: left; box-shadow: 0 10px 14px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);">
            <h3 style="text-align: center" id="application-name">
            ART</h4>
            <h5 style="text-align: center"> v1.0.0</h5>
         </div>
         <div class="col-sm-2 col-lg-2 col-xl-2 cards" id="dates" style="margin-top: 2%; margin-left: 2%; border: solid 1px;overflow: auto; padding: 0; height: 520px; overflow: hidden; ">
            <h4 class="headers">Visit Dates</h4>
            <!-- <button class="btn btn-lg btn-primary" style="width: 80%; margin-left: 10%; ">  UP </button> -->
         </div>
         
         <div class="col-sm-10 col-lg-10 col-md-10 col-xs-10 cards" style="border: solid 2px;width: 80%; padding: 0; margin-left: 1%; height: 520px; margin-top: 2%;margin-right: 2%; width: 78%;" id="generic_tabs">
            <h4 class="headers"> Date Selected: <span id="selectedDate"></span></h4>
            <div class="row">
               <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="margin-left: 2%;border: solid 0px; width: 47%; margin-left: 3%;">
                  <!-- <h4 class="headers">Encounters</h4>
                     <div class="cards" id="encounters" style="border: solid 1px;border-bottom: 0px;  padding: 0; margin: 1%; height: 100px; overflow: hidden;">
                        <button type="button" id="0" class="btn btn-info btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">No Encounter History available </button>
                     </div> -->
                  <div class="card text-white bg-primary mb-3 cards" style="width: 98%; height: 200px; overflow: hidden;" data-toggle="modal" data-target="#myModal" onclick="populateModal();">
                     <div class="card-header h4 list-group-item-info" style="margin: 3%; padding: 1%;">Encounters</div>
                     <!-- <div class="card-body" id="encounters" style="overflow: hidden; max-height: 90px;" >
                        <h5 class="card-title">Primary card title</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        </div> -->
                     <table class="table" style="border: 0;">
                        <tbody id="encounters">
                           <!-- <tr id="enc">
                              </tr> -->
                        </tbody>
                     </table>
                     <div class="card-footer" style="margin: 1%;">
                     </div>
                  </div>
               </div>
               <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px; width: 48%; margin-left: 0%;" >
                  <!-- <h4 class="headers">Encounters</h4>
                     <div class="cards" id="encounters" style="border: solid 1px;border-bottom: 0px;  padding: 0; margin: 1%; height: 100px; overflow: hidden;">
                        <button type="button" id="0" class="btn btn-info btn-lg" style="width: 98%;  margin: 1%; border-radius: 0%;" onclick="">No Encounter History available </button>
                     </div> -->
                  <div class="card text-white bg-primary mb-3 btn-success cards" style="width: 98%; height: 200px; overflow: hidden;" data-toggle="modal" data-target="#myModal">
                     <div class="card-header h4 list-group-item-info" style="margin: 3%; padding: 1%;">Programs</div>
                     <!-- <div class="card-body" id="encounters" style="overflow: hidden; max-height: 90px;" >
                        <h5 class="card-title">Primary card title</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        </div> -->
                     <table class="table ">
                        <tbody id="programs">
                           <!-- <tr id="enc">
                              </tr> -->
                        </tbody>
                     </table>
                     <div class="card-footer" style="margin: 1%;">
                     </div>
                  </div>
               </div>
            </div>
            <div class="row" style="margin-top:10px;">
               <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px; width: 47%; margin-left: 3%;">
                  <div class="card text-white bg-primary mb-3 btn-danger cards" style="width: 98%; height: 200px; overflow: hidden;" data-toggle="modal" data-target="#myModal">
                     <div class="card-header h4 list-group-item-info" style="margin: 3%; padding: 1%;">Alerts</div>
                     <table class="table ">
                        <tbody id="encounters">
                        </tbody>
                     </table>
                     <div class="card-footer" style="margin: 1%;">
                     </div>
                  </div>
               </div>
               <div class="col-sm-6 col-lg-6 col-md-6 col-xs-6" style="border: solid 0px; width: 48%; margin-left: 0%; ">
                  <div class="card text-white bg-primary mb-3 btn-warning cards" style="width: 98%; height: 200px; overflow: hidden;" data-toggle="modal" data-target="#myModal">
                     <div class="card-header h4 list-group-item-info" style="margin: 3%; padding: 1%;">Latest Medication</div>
                     <table class="table ">
                        <tbody id="encounters">
                        </tbody>
                     </table>
                     <div class="card-footer" style="margin: 1%;">
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <footer class="footer">
         <div class="container-footer">
            <button id="btnNext" class="green right" style="margin: 5px 0px 0px; padding: 0px; float: right;" onclick="finish();">
            <span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Finish &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;</span>
            </button>
            <button class="btn btn-success buttons blue" style="margin-right: 5px;" data-toggle="modal" data-target="#appModal">
            <span>&nbsp;&nbsp; Applications &nbsp;&nbsp;<img src="/assets/images/launcher.png"></span>
            </button>
            <button id="activities" class="btn btn-success buttons blue" style="margin-right: 5px;" data-toggle="modal"
               onmousedown="showActivities(this); loadActivitiesContent(this.id);">
            <span>&nbsp; &nbsp; &nbsp; Activities &nbsp; &nbsp; &nbsp;</span>
            </button>
            <button class="btn btn-success buttons blue" style="margin-right: 5px;" data-toggle="modal" data-target="#appModal">
            <span>&nbsp; &nbsp; &nbsp; Tasks &nbsp; &nbsp; &nbsp;</span>
            </button>
         </div>
         </div>
      </footer>
      <div id="myModal" class="modal fade" role="dialog" style="">
         <div class="modal-dialog" >
            <!-- Modal content-->
            <div class="modal-content" style="margin: 0; max-height: 90%;">
               <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title"> <span id="encounterName"> </span></h4>
               </div>
               <div class="modal-body">
                 <div class="col-lg-3 col-sm-3 col-md-3 col-xs-3" class="border" id="encounters2"style="border-right: solid 1px;">
                    
                 </div>
                 <div class="col-lg-9 col-sm-9 col-md-9 col-xs-9">

                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Observation</th>
                        <th>Value</th>
                        <th>Time</th>
                      </tr>
                    </thead>
                    <tbody id="observationsTable">
                      
                      <!-- <tr>
                        <td>Mary</td>
                        <td>Moe</td>
                        <td>mary@example.com</td>
                      </tr>
                      <tr>
                        <td>July</td>
                        <td>Dooley</td>
                        <td>july@example.com</td>
                      </tr> -->
                    </tbody>
                  </table>
                 </div>
                 
                  <div class="modal-footer">
                     <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                     <div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!-- Modal -->
      <div class="modal fade" id="appModal" data-backdrop="static" data-keyboard="false" role="dialog">
      <div class="modal-dialog" name="div2">
         <div class="modal-content" style="margin-left:0px;">
            <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal">&times;</button>
               <h4 class="modal-title">Select module</h4>
            </div>
            <div class="modal-body">
               <div class="container">
                  <div class="row" id="modal-div">
                     <template id="card_template">
                        <!-- <div class="" > -->
                        <a href="#" class="card-block clearfix" id="moduleButton" onclick="$('#appModal').modal('hide');">
                           <div class="app-btn" id="cardDiv" style="margin: 10px;" >
                              <img alt="Avatar" style="width:70px; height: 60px; margin-top: 10%;" id="cardImage">
                              <div class="middle">
                                 <div class="text">
                                    <p id="apptext"></p>
                                 </div>
                              </div>
                              <div class="card-container">
                                 <h4>
                                    <b id="appName"></b>
                                 </h4>
                                 <p id="appDescription"></p>
                              </div>
                           </div>
                        </a>
                     </template>
                  </div>
               </div>
            </div>
         </div>
         <div>
         </div>
      </div>
      <div id="cover">
      </div>
      <div class="confirm">
         <h1>Confirm your action</h1>
         <p>Are you really <em>really</em> <strong>really</strong> sure that you want to void the selected encounter?</p>
         <button onclick="hidePopup();">Cancel</button>
         <button autofocus onclick="confirmAction();">Confirm</button>
      </div>
   </body>
   <script src="/assets/js/core.js "></script>
   <script>
      generateTemplate();
      var url = new URL(url);
      var apiURL = sessionStorage.getItem("apiURL");
      var apiPort = sessionStorage.getItem("apiPort");
      var apiProtocol = sessionStorage.getItem("apiProtocol");
      var id = url.searchParams.get("patient_id");
      sessionStorage.setItem("patientID", id);
      (document.getElementsByClassName("overview-btns ")[0]);
      (document.getElementsByClassName("activities-btns ")[0]);
      changeModule();
      url = new URL(url);
      var d = new Date();
      
      function ajaxRequest() {
        var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/patients/' + id;
        var req = new XMLHttpRequest();
        req.onreadystatechange = function () {
      
          if (this.readyState == 4 && this.status == 200) {
            var results = JSON.parse(this.responseText);
            var age = results.person.birthdate;
            var gender = results.person.gender;
            var identifier = "";
            var patient_name = results.person.names[0].given_name + " " + results.person.names[0].family_name;
            var addressl1 = results.person.addresses[0].address1;
            var addressl2 = results.person.addresses[0].address2;
            var phone_number = results.person.person_attributes[1].value;
            try {
              identifier = results.patient_identifiers[0].identifier || "no value available";
            } catch (e) {
      
            }
      
            setValues(patient_name, gender, age, addressl1, addressl2, phone_number, identifier);
          }
        };
        try {
          req.open('GET', url, true);
          req.setRequestHeader('Authorization', sessionStorage.getItem("authorization"))
          req.send(null);
        } catch (e) {}
      }
      
      function finish() {
        window.location = "/";
      }
      
      function setValues(patient_name, gender, age, addressl1, addressl2, phone_number, identifier) {
        document.getElementById("patient_name").innerHTML = patient_name;
        // document.getElementById("gender").innerHTML = gender;
        var roundedAge = Math.floor(moment().diff(age, 'years', true));
        console.log(roundedAge);
        document.getElementById("DOB").innerHTML = moment(age).format("DD/MMM/YYYY");;
        document.getElementById("npid").innerHTML = identifier;
        document.getElementById("age").innerHTML = "("+roundedAge+")";
        document.getElementById("addressl1").innerHTML = addressl1;
        document.getElementById("addressl3").innerHTML = addressl2;
        document.getElementById("phone_number").innerHTML = phone_number;
        changeIcon(gender);
      }
      
      function getDates(patient_id) {
        var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/patients/' + patient_id + '/visits';
        var div = document.getElementById("dates");
        var req = new XMLHttpRequest();
        id = patient_id;
        req.onreadystatechange = function () {
      
          if (this.readyState == 4 && this.status == 200) {
            var results = JSON.parse(this.responseText);
                    for (var x = 0; x < results.length; x++) {
                      
              div.innerHTML += '<button type="button" id="' + x + '" value="' + results[x] +
                '" class="app-btn btn btn-primary" style="width: 90%;  margin-left: 5%;margin-top: 2%; margin-bottom: 2%; border-radius: 0%; color:black;"  onclick="this.style.color=0xffffff;getValue(this.value,' + patient_id + ',&#034;encounters&#034;, &#034;h4&#034;, &#034;table&#034;); getPrograms(' + patient_id +');">' +
                moment(results[x]).format("DD/MMM/YYYY"); + '</button>';
                if (x == 4) {
                    break;
                  }
                if (x == 0) {
                // console.log(results[0]);
                  getValue(results[0], patient_id, "encounters", "h4", "table");
                  getPrograms(patient_id);
                  
              }
            }
          }
        };
        try {
          req.open('GET', url, true);
          req.setRequestHeader('Authorization', sessionStorage.getItem('authorization'));
          req.send(null);
        } catch (e) {}
      }
      
      getDates(id);
      
      function getValue(value, id, div, className, itemType) {
        // console.log(value);
      
        var encounters = document.getElementById(div);
        var selectedDate = document.getElementById("selectedDate");
        selectedDate.innerHTML = moment(value).format("DD/MMM/YYYY");
        sessionStorage.setItem("value", value);
        if (encounters.innerHTML != null) {
          encounters.innerHTML = "";
        } else {}
        var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/encounters?patient_id=' + id + '&date=' + value;
        var req = new XMLHttpRequest();
        // document.createElement()
        req.onreadystatechange = function () {
      
          if (this.readyState == 4 && this.status == 200) {
            
            var results = JSON.parse(this.responseText);
            console.log(results);
            for (var x = 0; x < results.length; x++) {
               var d = new Date(results[x].encounter_datetime);
               var f = moment(d).format("hh:mm:ss");
              
              if (itemType == "table") {

              encounters.innerHTML += '<tr><td id="' + x +
                '" class="h4" name="" style="width: 98%;  margin: 1%; border-radius: 0%; border-top-width: 0px;"><li>' +
                results[x].type.name + '</li></td> <td class="h4" style="border-top-width: 0px;">'+ f +'</td> </tr>';
                if (x == 1) {
                  encounters.innerHTML += '<li class ="h4" style="list-style: none;">...... click to view more </li>';
                  break;
                  
                }
              }else if (itemType == "button") {
                encounters.innerHTML +=
                '<button type="button" id="' + results[x].encounter_ixd + '" value="' + results[x] +
                '" class="btn btn-primary btn-sm" style="width: 98%;  margin: 1%; border-radius: 0%; height: 50px;" onClick="getEncounter('+results[x].encounter_id+')">' +
                '<span class="h5">'+ results[x].type.name + '</span></button>';
              }
                if (x == results.length -1) {
                }

                // document.getElementById()
            }
          }
        };
        try {
          req.open('GET', url, true);
          req.setRequestHeader('Authorization', sessionStorage.getItem('authorization'));
          req.send(null);
        } catch (e) {}
      
      }
      function populateModal() {
        var location = document.getElementById("encounterLocation");
        // location.innerHTML = "aaa";
        getValue(sessionStorage.value, sessionStorage.patientID, "encounters2", "btn btn-primary btn-lg", "button");
      }
      function getPrograms(id) {
      
      var programs = document.getElementById("programs");
      if (programs.innerHTML != null) {
          programs.innerHTML = "";
        } else {}
      var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/patients/' + id + '/programs/';
      var req = new XMLHttpRequest();
      req.onreadystatechange = function () {
      
      if (this.readyState == 4 && this.status == 200) {
        var results = JSON.parse(this.responseText);
        for (var x = 0; x < results.length; x++) {
              var d = new Date(results[x].date_enrolled);
              var f = moment(d).format("hh:mm:ss");
           var name = results[x].program.concept.concept_names[0].name;
          programs.innerHTML += '<tr><td  id="' + x +
            '" class="h4" style="width: 98%;  margin: 1%; border-radius: 0%; border-top-width: 0px;" onclick="">' +
            name.toUpperCase()+ '</td> <td style="border-top-width: 0px;" class="h4">'+ f +'</td></tr>';
        }
      }
      };
      try {
          req.open('GET', url, true);
          req.setRequestHeader('Authorization', sessionStorage.getItem('authorization'));
          req.send(null);
        } catch (e) {}
      
      }

     function  getEncounter(id) {
       
          var obsDiv = document.getElementById("observationsTable");   
          if (obsDiv.innerHTML != null) {
          obsDiv.innerHTML = "";
        } else {}
          var url = 'http://' + apiURL + ':' + apiPort + '/api/v1/encounters/' + id ;
          var req = new XMLHttpRequest();
          req.onreadystatechange = function(){
          
          if (this.readyState == 4 && this.status == 200) {
          
          var results = JSON.parse(this.responseText);

          console.log
          for(var x = 0; x < results.observations.length; x ++){
            var d = new Date(results.observations[x].obs_datetime);
          // var f = d.getHours() + ':' + d.getMinutes() + ':' + d.getSeconds(); 
          var f = moment(d).format("hh:mm:ss");
            obsDiv.innerHTML += '<tr>  <td>'+results.observations[x].concept.concept_names[0].name+'</td><td>'+results.observations[x].value_text+'</td>  <td>'+f+'</td> </tr>'
          }
          }
          };
          try {
          req.open('GET', url, true);
          req.setRequestHeader('Authorization',sessionStorage.getItem('authorization'));
          req.send(null);
          } catch (e) {
          }
          
      }
      
      ajaxRequest();
      
   </script>
</html>
<script src="/assets/js/generic_ajaxrequest.js"></script>