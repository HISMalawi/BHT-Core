<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

    <script language="javascript">
      tstUsername = "";
      tstUserKeyboardPref = "qwerty";

      var d = new Date();
      d.toDateString();

      function getInput(){
         key = $('touchscreenInput' + tstCurrentPage).getAttribute("key");
         value = $('touchscreenInput' + tstCurrentPage).value
         sessionStorage.setItem(key, value);
         var d = new Date();
         sessionStorage.setItem("date_created", d.toDateString());
      }

      function changeFinishBtn() {
        var finishButton =  __$("nextButton");
        finishButton.setAttribute('onmousedown',"createClient();");
        finishButton.setAttribute('onclick',"");
      }

      function resetFinishBtn() {
        var finishButton =  __$("nextButton");
        finishButton.setAttribute('onmousedown',"gotoNextPage();");
        finishButton.setAttribute('onclick',"");
      }

      function createClient() {
        parameter = {
          given_name:         __$('given_name').value,
          middle_name:        __$("middle_name").value,
          famiy_name:         __$('family_name').value,
          gender:             __$('gender').value,


          current_district:   __$('current_district').value, 
          current_ta:         __$('current_ta').value,
          current_village:    __$('current_village').value,

          home_district:       __$('home_district').value,
          home_ta:             __$('home_ta').value,
          home_village:        __$('home_village').value,

          landmark:           __$('landmark').value,
          cell_phone_number:  __$('cellphone').value
        }

        PersistData(parameter, 'people');
      }

      function changeNextButton(){
         __$("nextButton").removeAttribute("onmousedown")
         __$("nextButton").onmousedown = function(){
            confirm_password = $('touchscreenInput' + tstCurrentPage).value;
            if (sessionStorage.getItem("password") === confirm_password){
              window.location.href = "show.html";
               }
               else{
                //  alert("passwords do not match");
                 
               }
         }
      }


      function summary() {
        parameter = {
          given_name:         __$('given_name').value,
          middle_name:        __$("middle_name").value,
          family_name:         __$('family_name').value,
          gender:             __$('gender').value,


          current_district:   __$('current_district').value, 
          current_ta:         __$('current_ta').value,
          current_village:    __$('current_village').value,

          home_district:       __$('home_district').value,
          home_ta:             __$('home_ta').value,
          home_village:        __$('home_village').value,

          landmark:           __$('landmark').value,
          cell_phone_number:  __$('cellphone').value
        }

        var table = document.createElement('table');
        table.setAttribute('class','summary-table');

        var attributes = [
          ["Given name", parameter.given_name],
          ["Middle name", parameter.middle_name],
          ["Family name", parameter.family_name],
          ["Gender", parameter.gender],
          ["Home District", parameter.home_district],
          ["Home TA", parameter.home_ta],
          ["Home Village", parameter.home_village],
          ["Current District", parameter.current_district],
          ["Current TA", parameter.current_ta],
          ["Current Village", parameter.current_village],
          ["Landmark", parameter.landmark],
          ["Cell phone", parameter.cell_phone_number]
        ];

        for(var i = 0 ; i < attributes.length; i++){

          var row = document.createElement('tr');
          row.setAttribute('class','summary-table-row');
          table.appendChild(row);
      
          var th = document.createElement('th');
          th.innerHTML = attributes[i][0];
          row.appendChild(th);

          var td = document.createElement('td');
          td.innerHTML = attributes[i][1];

          if(attributes[i][0].match(/Current District/i)){
            getObjects(td, attributes[i][1], "District", "/districts?region_id=" + document.getElementById('current_region').value);
          }else if(attributes[i][0].match(/Current TA/i)){
            getObjects(td, attributes[i][1], "TA", "/traditional_authorities?district_id=" + document.getElementById('current_district').value);
          }else if(attributes[i][0].match(/Current Village/i)){
            getObjects(td, attributes[i][1], "Village", "/villages?traditional_authority_id=" + document.getElementById('current_ta').value);
          }    
          
          if(attributes[i][0].match(/Home District/i)){
            getObjects(td, attributes[i][1], "District", "/districts?region_id=" + document.getElementById('home_region').value);
          }else if(attributes[i][0].match(/Home TA/i)){
            getObjects(td, attributes[i][1], "TA", "/traditional_authorities?district_id=" + document.getElementById('home_district').value);
          }else if(attributes[i][0].match(/Home Village/i)){
            getObjects(td, attributes[i][1], "Village", "/villages?traditional_authority_id=" + document.getElementById('home_ta').value);
          }    
          

          row.appendChild(td);

          
        }

        var f = document.getElementById('inputFrame' + tstCurrentPage);
        f.appendChild(table);
      }

    </script>    

    <script type="text/javascript" src="/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
    <script type="text/javascript" src="/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script>
    <script type="text/javascript" src="/apps/core/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/apps/core/assets/js/core.js"></script>

  </head>
  <body id="mateme">
    <div id="container">
      <div id="content">
        <style>

  .tt_controls_year_of_birth #qwerty { display:none; }
  .tt_controls_age_estimate #qwerty { display:none; }
  .tt_controls_cell_phone_number #qwerty { display:none; }
  .tt_controls_ground_phone_number #qwerty { display:none; }
  .tt_controls_office_phone_number #qwerty { display:none; }

  .tt_controls_year_of_birth #Unknown { display:block; }
  .tt_controls_age_estimate #Unknown { display:none; }

  .tt_controls_middle_name  #na { display: block; }
  .tt_controls_ground_phone_number #Unknown { display:block; }

  .tt_controls_region_of_origin .keyboard{display:none;}
  .tt_controls_current_region .keyboard{display:none;}

  .tt_controls_month_of_birth .keyboard{display:none;}
  #tt_page_month_of_birth .options{height:570px;}
  #tt_page_month_of_birth .options li{font-size:30px;}

  .tt_controls_home_village #space , #apostrophe { display:inline; }

  .tt_controls_current_traditional_authority_ta #space { display:inline; }

  .tt_controls_current_village_residence #space { display:inline; }

  .tt_controls_cell_phone_number #num , #plus, #apostrophe, #star, #char, #abc, #date, #slash, #minus, #comma, #percent, #decimal { display:none; }

  .tt_controls_guardian_cell_phone_number #num , #plus, #apostrophe, #star, #char, #abc, #date, #slash, #minus, #comma, #percent, #decimal { display:none; }

  .tt_controls_home_phone_number #num , #plus, #apostrophe, #star, #abc, #date, #slash, #minus, #comma, #percent, #decimal { display:none; }

  .tt_controls_office_phone_number #num , #plus, #apostrophe, #star, #abc, #date, #slash, #minus, #comma, #percent, #decimal { display:none; }

  .tt_controls_occupation .keyboard{display:none;}
  #tt_page_occupation .options{height:500px;}
  #tt_page_occupation .options li{font-size:30px;}
  #space {display:inline;}

  .nota #na {
    display: block;
  }

  #num{ display:block; }
  #char{ display:none; }
  #apostrophe { display:inline; }

  .tt_controls_current_district #num{ display:none; }

  .tt_controls_current_city_place_or_area_of_residence #num{ display:block; }
  .tt_controls_current_city_place_or_area_of_residence #char{ display:block; }

  .tt_controls_closest_landmark_or_plot_number #num{ display:block; }
  .tt_controls_closest_landmark_or_plot_number #char{ display:block; }

  .azButton .numericKeyboard #char {
    display: block;
  }

  .tt_controls_home_district #viewport { display:inline; }
  .tt_controls_home_district #num { display:none; }

  #tt_page_home_district #viewport { display: inline !important; }
  #tt_page_home_ta #viewport { display: inline !important; }
  #tt_page_home_village #viewport { display: inline !important; }

  #tt_page_current_district #viewport { display: inline !important; }
  
  #tt_page_current_ta #viewport { 
    display: inline !important; 
    height: 55%;
  }


  #tt_page_home_ta .inputFrameClass {
    height: 50%;
    overflow: auto;
  }

  #tt_page_home_village .inputFrameClass {
    height: 50%;
    overflow: auto;
  }

  #tt_page_current_ta .inputFrameClass {
    height: 50%;
    overflow: auto;
  }

  #tt_page_current_village .inputFrameClass {
    height: 50%;
    overflow: auto;
  }

 .summary-table {
   width: 100%;
   border-collapse: collapse;
 }

 .summary-table th {
   border-style: solid;
   border-width: 0px 0px 1px 0px;
   text-align: left;
   padding-left: 5px 0px 10px 0px;
   width: 20%;
   height: 40px;
 }

 .summary-table td {
   border-style: solid;
   border-width: 0px 0px 1px 0px;
   text-align: left;
   padding-left: 5px 0px 10px 0px;
   height: 40px;
 }

</style>

<script type="text/javascript">
  var tt_cancel_destination = "/"
  var date_diff = "2008-08-31"

  function validateDate() {
    selectYear = parseInt(document.getElementsByName('person[birth_year]')[0].value);
    selectDay = parseInt(document.getElementsByName('person[birth_day]')[0].value);
    date = new Date
    currYear = date.getFullYear();
    currDay = date.getDate();
    availableMonths = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    if (selectYear == currYear){
      currentMonth = [];
      numOfloops = ((new Date).getMonth() + 1);
      for(var i = 0; i < numOfloops; i++){
        currentMonth.push(availableMonths[i]);
      }
      rule = currentMonth.join("|");
      rule = rule + "|Unknown";
      return $('touchscreenInput'+tstCurrentPage).setAttribute('validationRule',rule);
    }
    if (selectYear != currYear) {
      rule = availableMonths.join("|");
      rule = rule + "|Unknown";
      return $('touchscreenInput'+tstCurrentPage).setAttribute('validationRule',rule);
    }
  }

  function validateYear() {
    selectYear = parseInt(document.getElementsByName('person[birth_year]')[0].value);
    selectDay = parseInt(document.getElementsByName('person[birth_day]')[0].value);
    date = new Date
    currYear = date.getFullYear();
    currDay = date.getDate();

    abMax = parseInt(date_diff.split("-")[0]) - 10;

    jQuery('#touchscreenInput'+ tstCurrentPage).attr("absoluteMax", date_diff.split("-")[0]);

  }
  function updateMonthAbsMax(){
    var month = jQuery('#person_birth_month').val();
    var year = jQuery('#person_birth_year').val();
    
    if ((parseInt(year) == parseInt(date_diff.split("-")[0])) && (parseInt(month) > parseInt(date_diff.split("-")[1]))) {
      var message = "Month selected is greater than Current Month";
      setTimeout(function () {
        gotoPage(tstCurrentPage - 1, false, true);
        showMessage(message,null,30000);
      }, 10);
    }
  }

  function updateDayAbsMax(){
    var month = jQuery('#person_birth_month').val();
    var year = jQuery('#person_birth_year').val();
    if ((parseInt(year) == parseInt(date_diff.split("-")[0])) && (parseInt(month) == parseInt(date_diff.split("-")[1]))){
      jQuery('#touchscreenInput'+ tstCurrentPage).attr("absoluteMax", date_diff.split("-")[2]);
    }
  }

  function validateDay(){
    date = new Date
    currYear = date.getFullYear();
    currDay = date.getDate();
    currMonth = date.getMonth() + 1;
    selected_month = parseInt(document.getElementsByName('person[birth_month]')[0].value)
    selectYear = parseInt(document.getElementsByName('person[birth_year]')[0].value);
    if (selectYear == currYear) {
      if (selected_month == currMonth){
        return $('touchscreenInput'+tstCurrentPage).setAttribute('absoluteMax',currDay);
      }
    }
  }

  function dateCreate(date_str){
    intyear = 0 ; intmonth = 0 ; intday = 0;
    intyear = parseInt(date_str.substring(0,4))
    intmonth = (parseInt(date_str.substring(5,7)) - 1)
    intday = (parseInt(date_str.substring(8,10)))

    if (intmonth == -1)
      intmonth = (parseInt(date_str.substring(5,7).substring(1,2)) - 1)

    if (intday == 0)
      intday = parseInt(date_str.substring(8,10).substring(1,2))

    return new Date(intyear,intmonth,intday);
  }

  function set_ajaxURL_for_suggestions(url, filter_value) {
    $('touchscreenInput'+tstCurrentPage).setAttribute('ajaxURL', url + filter_value + "&page_size=100&name=");
    listSuggestions(tstCurrentPage);
  }


</script>

<form action="/apps/core/views/patient_dashboard.html" method="POST">

  <input type="text" name="given_name" 
  id="given_name" field_type="alpha" 
  key="first_name" helpText="First name"  
  ajaxURL="/search/given_name?search_string=" 
  key="first_name" allowFreeText="true" 
	condition="$(&quot;given_name&quot;).value == &quot;&quot;" /> 

  <input type="text" name="person[names][family_name]" 
  id="family_name" value="Testing" field_type="alpha" 
  helpText="Last name" 
  ajaxURL="/search/family_name?search_string=" 
  allowFreeText="true" 
	condition="$(&quot;family_name&quot;).value == &quot;&quot;" /> 

  <input type="text" name="person[names][middle_name]" 
  id="middle_name" field_type="alpha" 
  helpText="Middle name" 
  ajaxURL="/search/middle_name?search_string=" 
  allowFreeText="true" optional="true" 
  condition="$('middle_name').value == ''" 
  tt_pageStyleClass="azButton" />

  <input type="text" name="person[birth_year]" id="person_birth_year" helpText="Year of Birth" field_type="number" absoluteMin="1900" min="1900" tt_onLoad="validateYear()" tt_pageStyleClass="Numeric NumbersOnly" />

  <select name="person[birth_month]" id="person_birth_month" helpText="Month of Birth" condition="$('person_birth_year').value.toLowerCase() != 'unknown'" validationMessage="Please enter a valid date" tt_onLoad=" validateDate();__$(keyboard).style.display = none;" tt_onUnLoad="updateMonthAbsMax();"><option value=""></option>
  <option value="1">Jan</option>
  <option value="2">Feb</option>
  <option value="3">Mar</option>
  <option value="4">Apr</option>
  <option value="5">May</option>
  <option value="6">Jun</option>
  <option value="7">Jul</option>
  <option value="8">Aug</option>
  <option value="9">Sep</option>
  <option value="10">Oct</option>
  <option value="11">Nov</option>
  <option value="12">Dec</option>
  <option value="Unknown">Unknown</option></select>

  <input type="text" name="person[age_estimate]" id="person_age_estimate" helpText="Age Estimate" absoluteMin="10" absoluteMax="120" field_type="number" condition="$('person_birth_year').value == 'Unknown'" tt_onLoad="$(nextButton).style.display = block;" tt_pageStyleClass="Numeric NumbersOnly" />

  <input type="text" name="person[birth_day]" id="person_birth_day" field_type="number" helpText="Birth Day" validationMessage="Please enter a valid date" condition="($('person_birth_year').value != 'Unknown') && ($('person_birth_month').value != 'Unknown')" tt_onLoad="validateDay(); getDayOfMonthPicker($(person_birth_year).value, $(person_birth_month).value);$(nextButton).style.display = block;updateDayAbsMax();" />

  <!-- Home Address ............................................. -->
  <input type="text" name="region[region_name]" 
    id="home_region" 
    field_type="alpha"
    xhelpText="Region"
    helpText="Region of origin"
    ajaxURL = "/regions"
    setvalue = ""
    tt_onLoad="clearInput();"
    requireNextClick = "false" 
    tt_pageStyleClass = "NoKeyboard"
    objectType="region" />
  
  <input type="text" name="home_district" 
    id="home_district" 
    field_type="alpha" 
    xhelpText="District"
    helpText="Home District"
    setvalue = "" 
    tt_pageStyleClass = "NoKeyboard"
    tt_onLoad="clearInput();set_ajaxURL_for_suggestions('/districts?region_id=', document.getElementById('home_region').value);"
    objectType="districts" />

  <input type="text" name="home_ta" 
  id="home_ta" field_type="alpha" 
  helpText="Home TA" 
  ajaxURL="" 
  tt_onLoad="clearInput();set_ajaxURL_for_suggestions('/traditional_authorities?district_id=', document.getElementById('home_district').value);"
  objectType="traditional_authority" />

  <input type="text" name="home_village" 
  id="home_village" field_type="alpha" 
  helpText="Home Village" 
  ajaxURL="" 
  tt_onLoad="clearInput();set_ajaxURL_for_suggestions('/villages?traditional_authority_id=', document.getElementById('home_ta').value);"
  objectType="village" />

  <!-- Home Address ............................................. -->

    <!-- ................... Current Address ........................... -->
  <input type="text" name="region[region_name]" 
    id="current_region" 
    field_type="alpha" 
    xhelpText="Region"
    helpText="Current Region"
    ajaxURL = "/regions"
    setvalue = ""
    requireNextClick = "false" 
    tt_pageStyleClass = "NoKeyboard"
    tt_onLoad="clearInput();"
    objectType="region" />
  
  <input type="text" name="current_district" 
    id="current_district" 
    field_type="alpha" 
    xhelpText="District"
    helpText="Current District"
    setvalue = "" 
    tt_pageStyleClass = "NoKeyboard"
    tt_onLoad="clearInput();set_ajaxURL_for_suggestions('/districts?region_id=', document.getElementById('current_region').value);"
    objectType="districts" />

  <input type="text" name="current_ta" 
    id="current_ta" field_type="alpha" 
    helpText="Current TA" 
    ajaxURL="" 
    tt_onLoad="clearInput();set_ajaxURL_for_suggestions('/traditional_authorities?district_id=', document.getElementById('current_district').value);"
    objectType="traditional_authority" />

  <input type="text" name="current_village" 
    id="current_village" field_type="alpha" 
    helpText="Current Village" 
    ajaxURL="" 
    tt_onLoad="clearInput();set_ajaxURL_for_suggestions('/villages?traditional_authority_id=', document.getElementById('current_ta').value);"
    objectType="village" />

    <!-- ................... Current Address ends ........................... -->



  <!-- <input type="text" name="p[addresses][city_village_a]" id="p_addresses_city_village_a" tt_onUnLoad="$(&quot;person_addresses_city_village&quot;).value = $(&quot;p_addresses_city_village_a&quot;).value" condition="$(&quot;filter_t_a&quot;).value == &quot;Other&quot;" ajaxURL="/person_addresses/village?search_string=" allowFreeText="true" field_type="alpha" helpText="Specify Location/Village" tt_pageStyleClass="azButton" tt_requireNextClick="true" tt_onLoad="$(&#39;nextButton&#39;).style.display = &#39;block&#39;;" /> -->

  <input type="text" name="person[addresses][address1]" id="landmark" 
    helpText="Closest Landmark or Plot Number<br /><span style='font-size:0.7em;font-style:italic'>(Please do not include these words: Next to, close, in front of, behind)</span>" allowFreeText="true" 
    tt_pageStyleClass="azButton" 
    tt_onLoad="$(nextButton).style.display = block;" />

  <input type="text" name="cellphone" id="cellphone" 
    helpText="Cell phone number"
    tt_pageStyleClass="azButton" 
    field_type="number"
    validationRule="^0\d{7}$|Unknown|Not Available|N/A|^0\d{9}$" 
    validationMessage="Not a valid phone number" 
    tt_onLoad="$(nextButton).style.display = block;" />
  
  <input type="text" name="summary" id="summary"
    tt_onLoad = "summary();__$('keyboard').style.display = 'none';changeFinishBtn();"
    tt_onUnLoad="resetFinishBtn();"
    optional = "true" tt_pageStyleClass = "NoControls" /> 

  <input type="text" name="person[guardian_cell_phone_number]" id="guardian_cellphone" field_type="number" helpText="Next of Kin Cell Phone Number" tt_onUnload="getInput();" validationRule="^0\d{7}$|Unknown|Not Available|N/A|^0\d{9}$" validationMessage="Not a valid phone number" tt_pageStyleClass="nota NumbersOnlyWithUnknown" /> -->

  <input type="hidden" name="person[gender]" id="gender" value="" />
  <input type="hidden" name="person[patient]" id="person_patient" value="" />

  <input type="hidden" name="relation" id="relation" value="" />

  <input type="hidden" name="identifier" id="identifier" value="" />

</form>

        <div id="footer">
        </div>
      </div>
    </div>
  </body>
</html>

<script type="text/javascript">
var tt_cancel_destination = "/apps/core/views/patient/search_results.html";

function getObjects(td, attribute, element_name, aUrl) {
  var url = apiProtocol+'://'+apiURL+':'+apiPort+'/api/v1' + aUrl;

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var obj = JSON.parse(this.responseText);
      if(element_name.match(/District/i)){
        districts = obj;
        for(var x = 0 ; x < districts.length; x++){
          if(districts[x].district_id == attribute){
            td.innerHTML = districts[x].name;
            break;
          }
        }
      }else if(element_name.match(/TA/i)){
        traditional_authorities = obj;
        for(var x = 0 ; x < traditional_authorities.length; x++){
          if(traditional_authorities[x].traditional_authority_id == attribute){
            td.innerHTML = traditional_authorities[x].name;
            break;
          }
        }
      }else if(element_name.match(/Village/i)){
        villages = obj;
        for(var x = 0 ; x < villages.length; x++){
          if(villages[x].village_id == attribute){
            td.innerHTML = villages[x].name;
            break;
          }
        }
      }
    }
  };
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader('Authorization',sessionStorage.getItem("authorization"));
  xhttp.send();
}

function setUrl(e, name) {
  __$(e).setAttribute('ajaxURL', "/districts?region_id=2");
}


function QueryString(URL) {
    // This function is anonymous, is executed immediately and 
    // the return value is assigned to QueryString!
    var query_string = {};
    var usefulParam = URL.split("?")[1] || "";
    var query = usefulParam || "";
    var vars = query.split("&");

    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split("=");
        
        // If first entry with this name
        if (typeof query_string[pair[0]] === "undefined") {
            query_string[pair[0]] = decodeURIComponent(pair[1]);
            // If second entry with this name
        } else if (typeof query_string[pair[0]] === "string") {
            var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];
            query_string[pair[0]] = arr;
            // If third or later entry with this name
        } else {
            query_string[pair[0]].push(decodeURIComponent(pair[1]));
        }
    }

		document.getElementById('given_name').value = query_string.given_name;
		document.getElementById('family_name').value = query_string.family_name;
		document.getElementById('gender').value = query_string.gender;
    return query_string;
}

QueryString(window.location.href);
</script>
